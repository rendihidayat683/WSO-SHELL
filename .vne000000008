# =========================
# wp-admin protection (IP whitelist + optional basic auth)
# Place this file in /wp-admin/.htaccess
# =========================

<IfModule mod_rewrite.c>
RewriteEngine On
</IfModule>

# ----- Block obvious dangerous extensions (no .shtml etc) -----
<FilesMatch "\.(shtml|shtm|phar|phtml\.bak|phtml\.tmp)$">
    Require all denied
</FilesMatch>

# ----- Block suspicious querystrings commonly used by shells -----
<IfModule mod_rewrite.c>
RewriteCond %{QUERY_STRING} (base64_encode|eval\(|assert\(|system\(|passthru\(|shell_exec\(|exec\(|phpinfo\(|_REQUEST|_FILES|GLOBALS) [NC]
RewriteRule .* - [F,L]
</IfModule>

# ----- Allow only specific IPs OR authenticated users -----
# Replace YOUR.IP.ADD.RESS with your admin IP (or add multiple IPs separated by a space)
<IfModule mod_authz_core.c>
  <RequireAny>
    Require ip YOUR.IP.ADD.RESS
    # Allow other IPs that authenticate via .htpasswd
    Require valid-user
  </RequireAny>
</IfModule>

<IfModule !mod_authz_core.c>
  Order deny,allow
  Deny from all
  Allow from YOUR.IP.ADD.RESS
  AuthType Basic
  AuthName "WP Admin"
  AuthUserFile /home/USERNAME/.htpasswd
  Require valid-user
</IfModule>

# If you use Basic Auth, create .htpasswd as explained below.
